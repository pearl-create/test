import streamlit as st

# 1. ì „ì—­ ë³€ìˆ˜ ì¤€ë¹„ (Streamlitì˜ ì„¸ì…˜ ìƒíƒœë¡œ ê´€ë¦¬)
# st.session_stateë¥¼ ì‚¬ìš©í•˜ì—¬ ì•± ì‹¤í–‰ ì¤‘ì—ë„ ê°’ì´ ìœ ì§€ë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
if 'ìŒë£Œëª©ë¡' not in st.session_state:
    st.session_state.ìŒë£Œëª©ë¡ = ["í¬ì¹´ë¦¬", "ì½œë¼", "ì‚¬ì´ë‹¤"]
    st.session_state.ê°€ê²©ëª©ë¡ = [1000, 1200, 1100]
    st.session_state.ì¬ê³ ëª©ë¡ = [2, 0, 3]

# --- í•¨ìˆ˜ ì •ì˜ ---

def display_menu():
    """
    ë©”ë‰´íŒì„ DataFrame í˜•íƒœë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.
    """
    # ë©”ë‰´ ì •ë³´ë¥¼ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë§Œë“¤ì–´ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
    data = {
        'ë²ˆí˜¸': [i + 1 for i in range(len(st.session_state.ìŒë£Œëª©ë¡))],
        'ìŒë£Œ': st.session_state.ìŒë£Œëª©ë¡,
        'ê°€ê²© (ì›)': st.session_state.ê°€ê²©ëª©ë¡,
        'ì¬ê³  (ê°œ)': st.session_state.ì¬ê³ ëª©ë¡
    }
    st.dataframe(data, hide_index=True)
    
# select_drink ë° process_sale ë¡œì§ì€ ì›¹ ì•± í˜•íƒœì— ë§ì¶° í•˜ë‚˜ì˜ 'êµ¬ë§¤' í•¨ìˆ˜ë¡œ í†µí•©í•©ë‹ˆë‹¤.

def process_purchase(ì„ íƒì¸ë±ìŠ¤):
    """
    ì„ íƒëœ ìŒë£Œë¥¼ êµ¬ë§¤ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ë¥¼ ì‚¬ìš©ìì—ê²Œ ì•Œë¦½ë‹ˆë‹¤.
    """
    # í˜„ì¬ ì¬ê³  í™•ì¸
    ì¬ê³  = st.session_state.ì¬ê³ ëª©ë¡[ì„ íƒì¸ë±ìŠ¤]
    ìŒë£Œì´ë¦„ = st.session_state.ìŒë£Œëª©ë¡[ì„ íƒì¸ë±ìŠ¤]

    if ì¬ê³  > 0:
        # â­ï¸ ì¬ê³  ê°ì†Œ ì²˜ë¦¬ (ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸)
        st.session_state.ì¬ê³ ëª©ë¡[ì„ íƒì¸ë±ìŠ¤] -= 1
        
        # ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥
        st.success(f"âœ… **{ìŒë£Œì´ë¦„}** êµ¬ë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! (ì”ì—¬ ì¬ê³ : {st.session_state.ì¬ê³ ëª©ë¡[ì„ íƒì¸ë±ìŠ¤]}ê°œ)")
        st.toast(f"'{ìŒë£Œì´ë¦„}' êµ¬ë§¤ ì™„ë£Œ!")
        
    else:
        # ì¬ê³  ë¶€ì¡± ë©”ì‹œì§€ ì¶œë ¥
        st.error(f"âŒ ì£„ì†¡í•©ë‹ˆë‹¤. **{ìŒë£Œì´ë¦„}**ì˜ ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.")
        st.toast(f"'{ìŒë£Œì´ë¦„}' ì¬ê³  ë¶€ì¡±!")
        
# --- [ë©”ì¸ Streamlit ì½”ë“œ ì‹¤í–‰] ---

st.set_page_config(page_title="ê³ êµ­ê³  ê°€ìƒ ìíŒê¸°", layout="centered")

st.title("ğŸ¤– ê³ êµ­ê³  ê°€ìƒ ìíŒê¸°")
st.markdown("### 1. ë©”ë‰´íŒ")

# 1. ë©”ë‰´íŒ ì¶œë ¥
display_menu()

st.markdown("---")
st.markdown("### 2. ìŒë£Œ ì„ íƒ ë° êµ¬ë§¤")

# ì‚¬ìš©ìë¡œë¶€í„° ìŒë£Œ ì„ íƒì„ ë°›ê¸° ìœ„í•œ ë¼ë””ì˜¤ ë²„íŠ¼
# ì¸ë±ìŠ¤ë¥¼ ë°˜í™˜ê°’ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
selected_drink_label = st.radio(
    "êµ¬ë§¤í•˜ì‹¤ ìŒë£Œë¥¼ ì„ íƒí•˜ì„¸ìš”:",
    options=[f"{i+1}. {st.session_state.ìŒë£Œëª©ë¡[i]} ({st.session_state.ê°€ê²©ëª©ë¡[i]}ì›)" 
             for i in range(len(st.session_state.ìŒë£Œëª©ë¡))],
    key="drink_selection"
)

# ì„ íƒëœ ë¼ë²¨ì—ì„œ ì¸ë±ìŠ¤ ì¶”ì¶œ (ì˜ˆ: "1. í¬ì¹´ë¦¬ (1000ì›)" -> 1 -> ì¸ë±ìŠ¤ 0)
# ì„ íƒëœ ë¼ë²¨ì˜ ì²« ê¸€ì(ë²ˆí˜¸)ë¥¼ ê°€ì ¸ì™€ 1ì„ ë¹¼ì„œ ì¸ë±ìŠ¤ë¡œ ë³€í™˜
selected_index = int(selected_drink_label.split('.')[0]) - 1

# êµ¬ë§¤ ë²„íŠ¼
if st.button("ğŸ’° êµ¬ë§¤í•˜ê¸°", use_container_width=True):
    # 3. íŒë§¤ ì²˜ë¦¬
    process_purchase(selected_index)

st.markdown("---")
st.markdown("### 3. [ê²°ê³¼] ë³€ê²½ëœ ì¬ê³ ")

# 4. ê²°ê³¼ í™•ì¸ (ì¬ê³  ë³€ê²½ í›„ì˜ ë©”ë‰´íŒì„ ë‹¤ì‹œ ì¶œë ¥)
display_menu()

st.info("ğŸ’¡ êµ¬ë§¤ê°€ ì™„ë£Œë˜ë©´ 'ë³€ê²½ ì¬ê³ 'ê°€ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.")
